<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script type="text/javascript" src="../base64url.js"></script>
<script type="text/javascript">
var DOMContentLoaded = new Promise(resolve => window.addEventListener("DOMContentLoaded", () => resolve()));
function encodeArray(array) {
	return btoaUrlSafe(Array.from(new Uint8Array(array), t => String.fromCharCode(t)).join(""));
}
function decodeArray(value) {
	return value ? Uint8Array.from(atobUrlSafe(value), t => t.charCodeAt(0)) : null;
}
function replacer(k,v) {
	if(v && v.constructor === Uint8Array) {
		return "["+encodeArray(v)+"]";
	}
	if(v && v.constructor === ArrayBuffer) {
		return "["+encodeArray(v)+"]";
	}
    return v;
}
function encodeJson(value) {
	return JSON.stringify(value, replacer, 2);
}
function translateRequest(json) {
    json.publicKey.user.id = decodeArray(json.publicKey.user.id);
    json.publicKey.challenge = decodeArray(json.publicKey.challenge);
    var output = { "publicKey": json.publicKey };
    console.log(encodeJson(output));
    return output;
}
function createCredential() {
    var create_request = fetch("http://localhost:5000/v2/credentials/create")
        .then(response => response.ok ? response.json() : Promise.reject(response))
        .then(json => translateRequest(json))
        .then(json => navigator.credentials.create(json))
        .catch(error => console.error(error));
}
DOMContentLoaded.then(() => $("#create").on("click", createCredential));
</script>
</head>
<body>
<p><a href="https://psteniusubi.example.com/push-demo/v2/credentials.html">psteniusubi.example.com</a></p>

<div><input type="button" id="create" value="Create" /></div>
</body>
</html>