<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="//code.jquery.com/jquery-3.3.1.js"></script>
<script type="text/javascript" src="subscription.js"></script>
<script type="text/javascript">
var DOMContentLoaded = new Promise(resolve => window.addEventListener("DOMContentLoaded", e => resolve()));
var tx = decode_location();
DOMContentLoaded.then(() => get_subscription(tx.subid)
    .then(json => {
        $("#subid").text(json.subid);
        $("#login_hint").text(json.login_hint);
    }));
function update_push_request_list() {
    get_push_request_all(tx.subid)
        .then(json => {
            $("#requests").empty();
            for(var i in json) {
                var p = $("<p>").text(JSON.stringify(json[i]));
                $("#requests").append(p);
                var id = encode_location(json[i].subid, json[i].push_id);
                var a = $("<a>").attr("href", "authorize.html#" + id).text(id);
                p = $("<p>").append(a);
                $("#requests").append(p);
            }
        })
        .then(() => setTimeout(update_push_request_list, 2500));
}
DOMContentLoaded.then(() => update_push_request_list());
</script>
</head>
<body>

<p>
<a href="registration.html">registration</a>
</p>

<div>
<p>
Subscription: <span id="subid"></span>
</p>
<p>
Login: <span id="login_hint"></span>
</p>
</div>

<div id="requests">
</div>

</body>
</html>